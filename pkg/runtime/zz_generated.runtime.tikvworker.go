//go:build !ignore_autogenerated
// +build !ignore_autogenerated

// Copyright 2024 PingCAP, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Code generated by runtime-gen. DO NOT EDIT.

package runtime

import (
	"time"
	"unsafe"

	"github.com/pingcap/tidb-operator/api/v2/core/v1alpha1"
	metav1alpha1 "github.com/pingcap/tidb-operator/api/v2/meta/v1alpha1"
	"k8s.io/apimachinery/pkg/api/meta"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
	"k8s.io/apimachinery/pkg/runtime"
	"k8s.io/utils/ptr"
)

type (
	TiKVWorker v1alpha1.TiKVWorker
)

type TiKVWorkerTuple struct{}

var _ InstanceTuple[*v1alpha1.TiKVWorker, *TiKVWorker] = TiKVWorkerTuple{}

func (TiKVWorkerTuple) From(t *v1alpha1.TiKVWorker) *TiKVWorker {
	return FromTiKVWorker(t)
}

func (TiKVWorkerTuple) FromSlice(t []*v1alpha1.TiKVWorker) []*TiKVWorker {
	return FromTiKVWorkerSlice(t)
}

func (TiKVWorkerTuple) To(t *TiKVWorker) *v1alpha1.TiKVWorker {
	return ToTiKVWorker(t)
}

func (TiKVWorkerTuple) ToSlice(t []*TiKVWorker) []*v1alpha1.TiKVWorker {
	return ToTiKVWorkerSlice(t)
}

func FromTiKVWorker(in *v1alpha1.TiKVWorker) *TiKVWorker {
	return (*TiKVWorker)(in)
}

func ToTiKVWorker(in *TiKVWorker) *v1alpha1.TiKVWorker {
	return (*v1alpha1.TiKVWorker)(in)
}

func FromTiKVWorkerSlice(ins []*v1alpha1.TiKVWorker) []*TiKVWorker {
	return *(*[]*TiKVWorker)(unsafe.Pointer(&ins))
}

func ToTiKVWorkerSlice(ins []*TiKVWorker) []*v1alpha1.TiKVWorker {
	return *(*[]*v1alpha1.TiKVWorker)(unsafe.Pointer(&ins))
}

var _ Instance = &TiKVWorker{}

func (in *TiKVWorker) DeepCopyObject() runtime.Object {
	return (*v1alpha1.TiKVWorker)(in).DeepCopyObject()
}

func (in *TiKVWorker) To() *v1alpha1.TiKVWorker {
	return ToTiKVWorker(in)
}

func (in *TiKVWorker) GetTopology() v1alpha1.Topology {
	return in.Spec.Topology
}

func (in *TiKVWorker) SetTopology(t v1alpha1.Topology) {
	in.Spec.Topology = t
}

func (in *TiKVWorker) GetUpdateRevision() string {
	if in.Labels == nil {
		return ""
	}
	return in.Labels[v1alpha1.LabelKeyInstanceRevisionHash]
}

func (in *TiKVWorker) CurrentRevision() string {
	return in.Status.CurrentRevision
}

func (in *TiKVWorker) SetCurrentRevision(rev string) {
	in.Status.CurrentRevision = rev
}

func (in *TiKVWorker) IsReady() bool {
	cond := meta.FindStatusCondition(in.Status.Conditions, v1alpha1.CondReady)
	if cond == nil {
		return false
	}
	if cond.ObservedGeneration != in.GetGeneration() {
		return false
	}

	return cond.Status == metav1.ConditionTrue
}

func (in *TiKVWorker) IsNotRunning() bool {
	cond := meta.FindStatusCondition(in.Status.Conditions, v1alpha1.CondRunning)
	if cond == nil {
		return false
	}
	if cond.ObservedGeneration != in.GetGeneration() {
		return false
	}
	return cond.Status == metav1.ConditionFalse
}

func (in *TiKVWorker) IsAvailable(minReadySeconds int64, now time.Time) bool {
	cond := meta.FindStatusCondition(in.Status.Conditions, v1alpha1.CondReady)
	if cond == nil {
		return false
	}
	if cond.ObservedGeneration != in.GetGeneration() {
		return false
	}
	if cond.Status != metav1.ConditionTrue {
		return false
	}
	if minReadySeconds == 0 {
		return true
	}
	minReadySecondsDuration := time.Duration(minReadySeconds) * time.Second
	if !cond.LastTransitionTime.IsZero() && cond.LastTransitionTime.Add(minReadySecondsDuration).Before(now) {
		return true
	}

	return false
}

func (in *TiKVWorker) IsUpToDate() bool {
	return in.Status.ObservedGeneration == in.GetGeneration() && in.GetUpdateRevision() == in.Status.CurrentRevision
}

func (in *TiKVWorker) Conditions() []metav1.Condition {
	return in.Status.Conditions
}

func (in *TiKVWorker) SetConditions(conds []metav1.Condition) {
	in.Status.Conditions = conds
}

func (in *TiKVWorker) ObservedGeneration() int64 {
	return in.Status.ObservedGeneration
}

func (in *TiKVWorker) SetObservedGeneration(gen int64) {
	in.Status.ObservedGeneration = gen
}

func (in *TiKVWorker) SetCluster(cluster string) {
	in.Spec.Cluster.Name = cluster
}

func (in *TiKVWorker) Cluster() string {
	return in.Spec.Cluster.Name
}

func (*TiKVWorker) Component() string {
	return v1alpha1.LabelValComponentTiKVWorker
}

func (in *TiKVWorker) Volumes() []v1alpha1.Volume {
	return in.Spec.Volumes
}

func (in *TiKVWorker) PodOverlay() *v1alpha1.PodOverlay {
	if in.Spec.Overlay == nil {
		return nil
	}
	return in.Spec.Overlay.Pod
}

func (in *TiKVWorker) PVCOverlay() []v1alpha1.NamedPersistentVolumeClaimOverlay {
	if in.Spec.Overlay == nil {
		return nil
	}
	return in.Spec.Overlay.PersistentVolumeClaims
}

func (in *TiKVWorker) Features() []metav1alpha1.Feature {
	return in.Spec.Features
}

func (in *TiKVWorker) SetVersion(version string) {
	in.Spec.Version = version
}

func (in *TiKVWorker) Version() string {
	return in.Spec.Version
}

func (in *TiKVWorker) SetImage(image string) {
	in.Spec.Image = ptr.To(image)
}

func (in *TiKVWorker) Subdomain() string {
	return in.Spec.Subdomain
}

func (in *TiKVWorker) ClusterCertKeyPairSecretName() string {
	sec := in.Spec.Security
	if sec != nil && sec.TLS != nil && sec.TLS.Cluster != nil && sec.TLS.Cluster.CertKeyPair != nil {
		return sec.TLS.Cluster.CertKeyPair.Name
	}
	prefix, _ := NamePrefixAndSuffix(in.GetName())
	return prefix + "-" + in.Component() + "-cluster-secret"
}

func (in *TiKVWorker) ClusterCASecretName() string {
	sec := in.Spec.Security
	if sec != nil && sec.TLS != nil && sec.TLS.Cluster != nil && sec.TLS.Cluster.CA != nil {
		return sec.TLS.Cluster.CA.Name
	}
	prefix, _ := NamePrefixAndSuffix(in.GetName())
	return prefix + "-" + in.Component() + "-cluster-secret"
}

func (in *TiKVWorker) IsOffline() bool {
	return false
}

func (in *TiKVWorker) IsStore() bool {
	return false
}

type (
	TiKVWorkerGroup v1alpha1.TiKVWorkerGroup
)

type TiKVWorkerGroupTuple struct{}

var _ GroupTuple[*v1alpha1.TiKVWorkerGroup, *TiKVWorkerGroup] = TiKVWorkerGroupTuple{}

func (TiKVWorkerGroupTuple) From(t *v1alpha1.TiKVWorkerGroup) *TiKVWorkerGroup {
	return FromTiKVWorkerGroup(t)
}

func (TiKVWorkerGroupTuple) FromSlice(t []*v1alpha1.TiKVWorkerGroup) []*TiKVWorkerGroup {
	return FromTiKVWorkerGroupSlice(t)
}

func (TiKVWorkerGroupTuple) To(t *TiKVWorkerGroup) *v1alpha1.TiKVWorkerGroup {
	return ToTiKVWorkerGroup(t)
}

func (TiKVWorkerGroupTuple) ToSlice(t []*TiKVWorkerGroup) []*v1alpha1.TiKVWorkerGroup {
	return ToTiKVWorkerGroupSlice(t)
}

func FromTiKVWorkerGroup(g *v1alpha1.TiKVWorkerGroup) *TiKVWorkerGroup {
	return (*TiKVWorkerGroup)(g)
}

func ToTiKVWorkerGroup(g *TiKVWorkerGroup) *v1alpha1.TiKVWorkerGroup {
	return (*v1alpha1.TiKVWorkerGroup)(g)
}

func FromTiKVWorkerGroupSlice(gs []*v1alpha1.TiKVWorkerGroup) []*TiKVWorkerGroup {
	return *(*[]*TiKVWorkerGroup)(unsafe.Pointer(&gs))
}

func ToTiKVWorkerGroupSlice(gs []*TiKVWorkerGroup) []*v1alpha1.TiKVWorkerGroup {
	return *(*[]*v1alpha1.TiKVWorkerGroup)(unsafe.Pointer(&gs))
}

var _ Group = &TiKVWorkerGroup{}

func (g *TiKVWorkerGroup) DeepCopyObject() runtime.Object {
	return (*v1alpha1.TiKVWorkerGroup)(g)
}

func (g *TiKVWorkerGroup) To() *v1alpha1.TiKVWorkerGroup {
	return ToTiKVWorkerGroup(g)
}

func (g *TiKVWorkerGroup) SetReplicas(replicas int32) {
	g.Spec.Replicas = &replicas
}

func (g *TiKVWorkerGroup) Replicas() int32 {
	if g.Spec.Replicas == nil {
		return 1
	}
	return *g.Spec.Replicas
}

func (g *TiKVWorkerGroup) SetVersion(version string) {
	g.Spec.Template.Spec.Version = version
}

func (g *TiKVWorkerGroup) Version() string {
	return g.Spec.Template.Spec.Version
}

func (g *TiKVWorkerGroup) SetImage(image string) {
	g.Spec.Template.Spec.Image = ptr.To(image)
}

func (g *TiKVWorkerGroup) SetCluster(cluster string) {
	g.Spec.Cluster.Name = cluster
}

func (g *TiKVWorkerGroup) Cluster() string {
	return g.Spec.Cluster.Name
}

func (*TiKVWorkerGroup) Component() string {
	return v1alpha1.LabelValComponentTiKVWorker
}

func (g *TiKVWorkerGroup) Conditions() []metav1.Condition {
	return g.Status.Conditions
}

func (g *TiKVWorkerGroup) SetConditions(conds []metav1.Condition) {
	g.Status.Conditions = conds
}

func (g *TiKVWorkerGroup) ObservedGeneration() int64 {
	return g.Status.ObservedGeneration
}

func (g *TiKVWorkerGroup) SetObservedGeneration(gen int64) {
	g.Status.ObservedGeneration = gen
}

func (g *TiKVWorkerGroup) SetStatusVersion(version string) {
	g.Status.Version = version
}

func (g *TiKVWorkerGroup) StatusVersion() string {
	return g.Status.Version
}

func (g *TiKVWorkerGroup) SetStatusReplicas(replicas, ready, update, current int32) {
	g.Status.Replicas = replicas
	g.Status.ReadyReplicas = ready
	g.Status.UpdatedReplicas = update
	g.Status.CurrentReplicas = current
}

func (g *TiKVWorkerGroup) StatusReplicas() (replicas, ready, update, current int32) {
	return g.Status.Replicas,
		g.Status.ReadyReplicas,
		g.Status.UpdatedReplicas,
		g.Status.CurrentReplicas
}

func (g *TiKVWorkerGroup) SetStatusRevision(update, current string, collisionCount *int32) {
	g.Status.UpdateRevision = update
	g.Status.CurrentRevision = current
	g.Status.CollisionCount = collisionCount
}

func (g *TiKVWorkerGroup) StatusRevision() (update, current string, collisionCount *int32) {
	return g.Status.UpdateRevision,
		g.Status.CurrentRevision,
		g.Status.CollisionCount
}

func (g *TiKVWorkerGroup) SetStatusSelector(l string) {
	g.Status.Selector = l
}

func (g *TiKVWorkerGroup) StatusSelector() string {
	return g.Status.Selector
}

func (g *TiKVWorkerGroup) TemplateLabels() map[string]string {
	return g.Spec.Template.Labels
}

func (g *TiKVWorkerGroup) TemplateAnnotations() map[string]string {
	return g.Spec.Template.Annotations
}

func (g *TiKVWorkerGroup) SetTemplateLabels(ls map[string]string) {
	g.Spec.Template.Labels = ls
}

func (g *TiKVWorkerGroup) SetTemplateAnnotations(anno map[string]string) {
	g.Spec.Template.Annotations = anno
}

func (g *TiKVWorkerGroup) Features() []metav1alpha1.Feature {
	return g.Spec.Features
}

func (g *TiKVWorkerGroup) SetTemplateClusterTLS(ca, certKeyPair string) {
	if g.Spec.Template.Spec.Security == nil {
		g.Spec.Template.Spec.Security = &v1alpha1.Security{}
	}
	sec := g.Spec.Template.Spec.Security
	if sec.TLS == nil {
		sec.TLS = &v1alpha1.ComponentTLSConfig{}
	}
	sec.TLS.Cluster = &v1alpha1.InternalTLS{}
	if ca != "" {
		sec.TLS.Cluster.CA = &v1alpha1.CAReference{
			Name: ca,
		}
	}
	if certKeyPair != "" {
		sec.TLS.Cluster.CertKeyPair = &v1alpha1.CertKeyPairReference{
			Name: certKeyPair,
		}
	}
}

func (g *TiKVWorkerGroup) ClusterCertKeyPairSecretName() string {
	defaultName := g.Name + "-" + g.Component() + "-cluster-secret"
	sec := g.Spec.Template.Spec.Security
	if sec != nil && sec.TLS != nil && sec.TLS.Cluster != nil && sec.TLS.Cluster.CertKeyPair != nil {
		return sec.TLS.Cluster.CertKeyPair.Name
	}
	return defaultName
}

func (g *TiKVWorkerGroup) ClusterCASecretName() string {
	defaultName := g.Name + "-" + g.Component() + "-cluster-secret"
	sec := g.Spec.Template.Spec.Security
	if sec != nil && sec.TLS != nil && sec.TLS.Cluster != nil && sec.TLS.Cluster.CA != nil {
		return sec.TLS.Cluster.CA.Name
	}
	return defaultName
}

func (g *TiKVWorkerGroup) MinReadySeconds() int64 {
	if g.Spec.MinReadySeconds == nil {
		return v1alpha1.DefaultTiKVWorkerMinReadySeconds
	}
	return *g.Spec.MinReadySeconds
}

func (g *TiKVWorkerGroup) SchedulePolicies() []v1alpha1.SchedulePolicy {
	return g.Spec.SchedulePolicies
}
