apiVersion: pingcap.com/v1alpha1
kind: TidbCluster
metadata:
  name: tici-demo
spec:
  version: v8.5.5
  imagePullPolicy: IfNotPresent
  timezone: UTC
  pvReclaimPolicy: Retain
  enableDynamicConfiguration: true
  discovery: {}
  helper:
    image: alpine:3.16.0

  pd:
    replicas: 1
    requests:
      storage: 1Gi
    config: |
      [replication]
        enable-placement-rules = true

  tikv:
    replicas: 1
    requests:
      storage: 1Gi

  tidb:
    replicas: 1
    service:
      type: ClusterIP

  tiflash:
    replicas: 1
    image: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tiflash/image:feature-fts
    storageClaims:
    - resources:
        requests:
          storage: 10Gi
      storageClassName: <storage-class>

  ticdc:
    replicas: 1
    image: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/ticdc/image:master

  tici:
    meta:
      replicas: 1
      image: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tici/image:master
    worker:
      replicas: 1
      image: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tici/image:master
    s3:
      endpoint: http://minio-service:9000
      region: us-east-1
      accessKey: "12345678"
      secretKey: "12345678"
      bucket: ticidefaultbucket
      prefix: tici_default_prefix
      usePathStyle: true
    changefeed:
      enable: true
      changefeedID: tici-replication-task
