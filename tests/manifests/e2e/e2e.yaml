---
apiVersion: v1
kind: Secret
metadata:
  name: webhook-secret
  namespace: tidb-operator-e2e
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2akNDQWRLZ0F3SUJBZ0lJTWl6YTcrRVl1RnN3RFFZSktvWklodmNOQVFFTEJRQXdFakVRTUE0R0ExVUUKQXhNSFkyRXRZMlZ5ZERBZUZ3MHhPVEEwTVRZeE1UUTNNemRhRncweU1EQTBNVFV4TVRRM016ZGFNQzh4TFRBcgpCZ05WQkFNVEpIZGxZbWh2YjJzdGMyVmpjbVYwTG5ScFpHSXRiM0JsY21GMGIzSXRaVEpsTG5OMll6Q0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFMaW1tcy9zNlJyem8zRk1KeE14eTdJeE9VdWYKcGhZUGo2SE5QWFJOek1RQUlIOFhLU09nS2ZBZjdQTmdycXNhaHJrSGZaaVlHRHVrVk5va0Exczk5eDR5VGNqRApXZGdOQmtRbWE4YldBNWkyQ1gzcEh2K0M4YlAyTzkrN0NXNkZtUEhKckFQdlhBa1RNdHVSdDVKbWNjZlFLYU9zClRMVVhqM1lBbWtpb1FCaTRVUExxZ1FSdVhWM0Jvc2V6QnljT3RtSW4xV2hJR09qWVRGMUNLNDhMS00zZXBHWWwKOHVhZGN6NUwvMkdhVGNDZEE3dUhGUCs5OERualpOaU9rMVJORFkxbENwYlNsYnV3dldBc1FtNVI5T2pOejdjUwpKcEpZUVk1a1FSTGRwTjQ1WUFGSXhuSml3MnFIbk1vZUVPbmYxd1FlZkk5LzVpTldXK1VxZFlDSElJOENBd0VBCkFhTW5NQ1V3RGdZRFZSMFBBUUgvQkFRREFnV2dNQk1HQTFVZEpRUU1NQW9HQ0NzR0FRVUZCd01CTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQkZyTjlORWRjSmZQVkdUWWR1d0doOHovekFRbTFmL0I1d3JWKzlaQ1RmSGZscAp2VDdaT01yQTZkaVJZTmdJbzZaWlRhYjN4WjNwNW1XaFROb2swV21ld2N0MGFCYXoyb2lIVkkvbi9MU2RaaUpIClBwTVovVG1jRzMxa3hMWjlOV3ZjclgrYWhDSWRVZ2JvVFpYZFVzZDdYUWdaVlhwSVNvK2kyc2JJdmZlNWNoZGgKaVpITy80bHBTVmpXUitWVTBMOGcvSHhscnJZcGRXUHVaQUtRQ01FYXBuU2Q3M2JBbGZoeENOQ3VPenRBdzNBVQo2T2ZqS2FrVjMvR2NqVnZ0bWp3eVdCVE5qdEo4QnViUSttU05hQjVmbXZwSDRHSVlZaXBHa3RMaStKSUFWWk1VCjRQZ1BoNW82bE8wRzZoTGkrZmQvamlIWVB6NXY4M0pLMDBjcDEwbjUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBdUthYXorenBHdk9qY1V3bkV6SExzakU1UzUrbUZnK1BvYzA5ZEUzTXhBQWdmeGNwCkk2QXA4Qi9zODJDdXF4cUd1UWQ5bUpnWU82UlUyaVFEV3ozM0hqSk55TU5aMkEwR1JDWnJ4dFlEbUxZSmZla2UKLzRMeHMvWTczN3NKYm9XWThjbXNBKzljQ1JNeTI1RzNrbVp4eDlBcG82eE10UmVQZGdDYVNLaEFHTGhROHVxQgpCRzVkWGNHaXg3TUhKdzYyWWlmVmFFZ1k2TmhNWFVJcmp3c296ZDZrWmlYeTVwMXpQa3YvWVpwTndKMER1NGNVCi83M3dPZU5rMkk2VFZFME5qV1VLbHRLVnU3QzlZQ3hDYmxIMDZNM1B0eElta2xoQmptUkJFdDJrM2psZ0FVakcKY21MRGFvZWN5aDRRNmQvWEJCNThqMy9tSTFaYjVTcDFnSWNnandJREFRQUJBb0lCQVFDM3UzZVI2MTlycFFCOQp6Tk9Zd3RTM3cwa0ttWm5PbTc5RXRZOHZ1ZlpGRlFkQXpvL3QxZ0hFNEUrTFFDbXRNYURhWGJ5NGFLYThPZUVBCmloTVk2QWlMY0d4N2x2NC8vMzI3dEN0TDEwb08yeHVJd0wxS2EwWUwxcmh1LzVINytrMWNVVnFyTTdIMWliZnkKU1FWTFZFcGxFeGxMdGpkQmZtY09lTDBNRFBaeVlNdE1pbVFDQ1FPRU1ETUhKRUlvK3NTc2JBeE1aaDhGa0hKbQpKK3BMUmRIcjk5QmxIMWo0Q1hBTC9OR3lVQU1LM0VOL21hZ28vWDlkcGRoc016MldqKzAzeFhZdHo4ZkdHYXBMCjhCUldjRCsvbjgvZEtqOHBFTy9aVFAxSm9vcW55ekdsa1pra21hUkhzZWorajl3RjJlK09UaVYxbUhnNEpHRVgKZTgyMHUvcDVBb0dCQU9Va2YycVNhNG00WTJadnM5UHRPcVBUOVB3WCtPUVBhenhaZHl0dklQb1EydjRYMGdJMgoxMGVBMU4zd2EyTCtZckFWK0hBbW9tQWg5NTNmS05hZUFUc1R5bUtkR2puRXVPazNnNU9PbElZWlVIMlpDcnBECjFRQXM5N2hPRzB1S2tRdTcvTHRjbGpmWitSVEI0OXQ5a2RTYkF3ZWhoTnkrOFQzbm9aUGZDRkRUQW9HQkFNNUwKSGJTb2NPZlh6bzIzOXI4eFNFdHpQT1phYXA0NmhkeUkxWllkSkl5a2NMZG9HZXJ2RmlRdWNiSGJaQXJaR0F6Rgp0MUM0cUxYdHp4cUFaSFJManN5NW16ckF5UjZvUVhZOTB5Mk1DWlZNZW0vMzh2Z0RrQUduU0dKSlI4Sm51UFB2Ck80bHErK2ZQVkFnVFQyekYzTDgyanBSUkZleTJYNWUrUGFIcEQvdlZBb0dCQU9PM1RxeXhVQTl3WDlBSUNEVC8KRjN5Q0FuK1lyeTZ0cUFzMGVicC9XTTFLZk9kdzhySmluN1NlY20wUkpSY2U2U0pHNHp0SkdhcmhkcnU4YjFCQgplOFdqR0VqQ0NiTUpMaDRPbmtMQXVoYytCd0NhVzgvWjQwNm1ZWlFXZ3dlaWNCeXlPQ3BXaTY1N2Z3NUMxVmRtClJjdDhOUm1iU1hjNmhuSFh4SG80ZG9JakFvR0FiRE5ONDJHdHhveVVsQlIzWVJTeVBKQzIwb04rQkh2aGxpaFgKRHFNK2RsNFJtTUVMUndRYjh1SkJVKzRrYk9RdER4WHM3blBNV1kvZjNxQ1ZEOEpKcGV0OEZiYmtSaVl1SDV5UgoxUVBzU3RpUUo0WS9kQUk2V0FPcm5aR2VCOE5yYU5hRHZiSFZhbUorU3JZR0pLRXJCVWZTUk15NjJTdFd2RHBXCkRVUTIwL2tDZ1lFQWowcXl4MDJ2V0Zqbjk3RnZpRVluRVVMQ1E0bWVYZEFyTTB2WHVUbjV3N25mOXdrZGl1eXcKRDV1VGxvd0QxRy9sMVBrN2dQYVZic0xwTEpZbVdFVWNiMytTamZSTXN5MUlXZC9jOEVlclQ5NXI0UGw2SWh6YgpnNTc3dmxBVWFBVE9LQmUrZ2NYRlFTNDZBU0JtZno3cFgwL3N1bHljNlVreXNLbE5jcUQ5SkkwPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN3akNDQWFxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFTTVJBd0RnWURWUVFERXdkallTMWoKWlhKME1CNFhEVEU1TURReE5qRXhORGN6TjFvWERUSTVNRFF4TXpFeE5EY3pOMW93RWpFUU1BNEdBMVVFQXhNSApZMkV0WTJWeWREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU5qNWRIdHpBbkV1CnBKQmtNMWRZUGplS2FuVlBoOVNKNS9NUlZkWTZqcElqM0ZDMGYxL3VuL3BsZ2NpU1FFdFhMRzZjTlk0VVgrNDAKMGwyYkNudWZYMEhlNjE1eFQxYUNqZzVBVGJENVhzbFNhYnpKRHdEZVUyalh1c0VwWXZUOWNTL2p0WENaK1o1dgpmMnpCdXFmUjVTK0l3ajRwSkRnK0tERFp6cnlRSXh5THBQS0xId0hPN0pNWDhQODc3Z2pnTVpnUm4xVVU4STRwCk8vSlV4Y3Z4bHBpZU9QWU03UnJRVGl6V3EzZHJlMy9iRGMyUjBGVlZqdVdJblAyenNXeGdvTjVZWjhIYlRrRE8KLzM0S1BHUlpHWitCNzNFT3FQRHRMd2hNZ3FrUGRFaGxkYjFCbUIyeXZTa05Icm84M3NnSGQyQXZGdXVqalZ6WApnaGRFNGNxcWFFc0NBd0VBQWFNak1DRXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBTEVpTWdiR1grdjdsTlNxN1ZIVTIyWm81NWJ4RWVVODVCQkIKdEhjdTZKbytQdlU0dENlaUR0ZVZuTGlYdkZQZWk2b2UyaHp3c3JFR0VuQUN1K25RM0gzLzlFTFFPdmhERXVlSApBeW8vK24zTkhScHl1MlBrSU1Zc3RPRDhaZml2TDJ3TnlpME0vNVhBWUV0eXBaelJIN2RmdS8vcW9YVnFUeEhNCkFaYndlK2V4b0hYUU1QVDBLdWd5RGNuYm5yb2g1ampSa093eUl6WmFsSE5nMHpJZkM1NVBHUHNVWGFiQ05Ja3QKbzNJcHFkdHp2UXNGUEtCNFA3c1diTEtWTVltb0xnQTZmQkZhVUF3MllXZUh4Sng4Sk01cVJEYnV5NVpidUFPUApKOHR3RFB1dTZtZGt2MUR2RDFzOTJIL2FCUkpYNVM1MWxaMytzKzlOS2RENGtYSHRkcXM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
---
apiVersion: v1
kind: Service
metadata:
  name: webhook-service
  namespace: tidb-operator-e2e
  labels:
    app: webhook-service
spec:
  ports:
  - port: 443
    targetPort: 443
  selector:
    app: webhook
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: tidb-operator-e2e
subjects:
- kind: ServiceAccount
  namespace: tidb-operator-e2e
  name: tidb-operator-e2e
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
---
kind: ServiceAccount
apiVersion: v1
metadata:
  namespace: tidb-operator-e2e
  name: tidb-operator-e2e
---
apiVersion: v1
kind: Pod
metadata:
  namespace: tidb-operator-e2e
  name: tidb-operator-e2e
  labels:
    app: webhook
spec:
  serviceAccount: tidb-operator-e2e
  containers:
  - name: tidb-operator-e2e
    image: ""
    imagePullPolicy: Always
    command:
    - /usr/local/bin/e2e
    - --operator-tag=e2e
    - --operator-image=pingcap/tidb-operator:latest
    - --tidb-versions=v2.1.3,v2.1.4
    - --tls-cert-file=/webhook.local.config/certificates/tls.crt
    - --tls-private-key-file=/webhook.local.config/certificates/tls.key
    volumeMounts:
    - mountPath: /logDir
      name: logdir
    - name: webhook-certs
      readOnly: true
      mountPath: /webhook.local.config/certificates
    env:
    - name: NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
  volumes:
  - name: logdir
    hostPath:
      path: /var/log
      type: Directory
  - name: webhook-certs
    secret:
      secretName: webhook-secret
  restartPolicy: Never
