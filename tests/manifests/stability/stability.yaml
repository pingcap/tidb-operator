---
apiVersion: v1
kind: Secret
metadata:
  name: webhook-secret
  namespace: tidb-operator-stability
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvRENDQWVTZ0F3SUJBZ0lJVS9pL0hYaGpvaXN3RFFZSktvWklodmNOQVFFTEJRQXdIVEViTUJrR0ExVUUKQXhNU1pUSmxMWE5sY25abGNpMWpaWEowTFdOaE1CNFhEVEU1TURReE5EQTJNVFUwTWxvWERUSXdNRFF4TXpBMgpNVFUwTTFvd05qRTBNRElHQTFVRUF4TXJkMlZpYUc5dmF5MXpaWEoyYVdObExuUnBaR0l0YjNCbGNtRjBiM0l0CmMzUmhZbWxzYVhSNUxuTjJZekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFMVmwKZCtTR1dONDNSd3hNTUt3MVZhWG1vYWRtWXU1VjNsNlhVTjczZTNSYUZ2RDlYZEI0MUovc0EvQmp5NThqSm1OKwpoYURTczgvMVA1L1JHODFhVExpUUZDS3FWdTY3bDQvR3Y1a1gyZ3I4UHJMcjBkVW9hbGpyYUpzbm9VdVJ5VEJQCkJWSm1BQWppQlAySmJoWldIVy9HWCtvNjNTa3NucHZmZEcxVXA3M3NCS0hYRCt5dXEydnVMOHI0WTIveHU4SnYKZUFhbUE0K0hHdHNuNlUrQWVwc0V3QjdDcEQ3SWd6ejVROE9HVWtUcVg1NVJtNFJyM3dyOWJDY3ZyZmZNd0VZZgpLME9jWmNEcG9yRnkyNkxCeWx6WjJCOWdDRlhzdFN6V2xaSDZ2TmhJaDZ5OEl3YzlvWjRWZWFJOTkzUmF4cHpRCi8ySzhhbGVCZHl3TmNLeFZGbVVDQXdFQUFhTW5NQ1V3RGdZRFZSMFBBUUgvQkFRREFnV2dNQk1HQTFVZEpRUU0KTUFvR0NDc0dBUVVGQndNQk1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQXFFRlE2NzVEMTlVMy9TWENOdk1XWAptMy9kdE0vd2V2b2JNZWdwbEFPSUdNT20xSW5ScDQ3MU1mZURURmUvQWpEL1JVZ1J6QlI0bGQxMC9Cc1B4SkFtCkk5OGJYd3N3UVhRSEE0NEtGcXN0SmdqbVpncHR4eVhNb3ptMnU4WHVHTHQ5UWJLcUU4UEdFZWFhSXJlRFg3TVEKaWdxRFlwTDV1cVpOYnRZekxhemllekZKYTJQeWkvSG5aeFZzTU1vdUFPdk5hMlduQUdDTWV1eDlCTStDMSt6SApjWnJOWVpZVWFMU2doSWJYa1dHMVoyenZONzFtUHd1TGtBcGFoUHMycDl6c0FLN3pmVVgrZjQxTlJUNWR6MGo5CkJUYWlQVlF6MWFVM2grOUhpSlNSV3FoeEViQjMrSjVOQXN6d1N0WktHYlBtdmlISjJqQkZ3aGRleU9zdmlheUgKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdFdWMzVJWlkzamRIREV3d3JEVlZwZWFocDJaaTdsWGVYcGRRM3ZkN2RGb1c4UDFkCjBIalVuK3dEOEdQTG55TW1ZMzZGb05LenovVS9uOUVielZwTXVKQVVJcXBXN3J1WGo4YS9tUmZhQ3Z3K3N1dlIKMVNocVdPdG9teWVoUzVISk1FOEZVbVlBQ09JRS9ZbHVGbFlkYjhaZjZqcmRLU3llbTk5MGJWU252ZXdFb2RjUAo3SzZyYSs0dnl2aGpiL0c3d205NEJxWURqNGNhMnlmcFQ0QjZtd1RBSHNLa1BzaURQUGxEdzRaU1JPcGZubEdiCmhHdmZDdjFzSnkrdDk4ekFSaDhyUTV4bHdPbWlzWExib3NIS1hObllIMkFJVmV5MUxOYVZrZnE4MkVpSHJMd2oKQnoyaG5oVjVvajMzZEZyR25ORC9ZcnhxVjRGM0xBMXdyRlVXWlFJREFRQUJBb0lCQUhCVWpaSXV3QW1jSVpzego4MUF4RndETmVYMjRvYnNGNGRhaHphckZodVhlaENab1FCaEJPeXB0ZFdMLzZiQjZpK05CRG04eEM3alVIcnBSCk8rNUc1UXZGN1RJcVdmc3NvQWFoQlRWQTEvM0ZodTQxcXBOZG03M0V5ZHFMQ0E5TUVGS2lIS0dTR0tObms3K04KdzJhQm5Xa0NaNU1kTUtlMndlRzAxdHg5ZUFMYmdsZ0VvQUVaR0g3c2lpUmpqd3hUN0dFd0FHSklTQWxobmUzUwo4UmhGY1dLNmp5QVRWS1RzY0Fhc2J3TVJXV21FcFFDMFhhNVhuZ01MR1piSmFCb20zM3RGbEd3dDFxdVhRbGkvCnV6UGZxNjhINVNaYisyOHArNS94ZmhuNlhPYVBaNVJ6QnpvVzBtV2tZOEFaR29STXVXLzV0TEVsdGpEQ1ZwZDkKaTVmQy8yRUNnWUVBMEc5TTl0Q2Z2eGpLSkU2UUcxL3hUcHNDNU0rbElERkFLUVVZWjFQamxWanUwcDkxc0FmUAoxNFRyakJCdlRJR2JGazhCN2tXQVI4Q3NSS0JPQVpqSkZFNmRGZFc4aStNK29PTzRVOTZNdDJIc0lKemxNT0JuCnk3ZWxSTjhXcGZCamNyK1QwWmtqOGV3M0g4QnhkOXZhYWE4WkRUWW1XaXhQM09CT0VTb0lYa2NDZ1lFQTNzcVgKZUgvZUhYblFlSlRsZ25MOTVoVUhJbEJ1eUU4NmlQb2k1SGVDWkZMUWgzR28rQmxLeXpBNm1BL3dwR2E0MEhlUwpnQkJwQTk3U3crYUtldGdoOEh0ODhEb0l6eWllZEdmVWkyQ0dPTWtNWDBLdjZ1c0RqcHlmWTB3KzdpMGFidURICkRWK1VTSjdtNjhzY05yNUFzVkx0anhqS0dFMk9Uc3FXQmpTL0gvTUNnWUFzK1djVTlvMFJrY3JFTE1PQmRLRS8Kd2NqTkVGVGo3bHlXdlVlM3UrMG1ZNHNjblZXcWh2VDgzdXhvUzMrSWRZcStOSXdKR3F3RVQzbWNVUzZqdjVEYgp0ZDdGUUZvdm9QZjVoVWxYcDNTYmVTQ1hKT043T1dDTUgzTWt1akpMMmVQTGRiVHlpK1dxcExwOE9tMEJYTW55Cjlkb2s5S012MzlIWHFmcU9UNUNBcndLQmdGVU5MRlFoSkc5R1FMSzN6UUpHMmV6TEhFVWFSYUNNdG9EeVZQMjUKTGZzVXJtejJsQlhhdWZYbHZJaXVsU1I5M3BJZkE3dUdDRUVsQUhzdStMQzY4QUg1Y3BIVzVlUUgwcTRIc1ZsZwpDUDJHcXdWMjFPZXV2bFhrTHVqZWc2dXpaa0xyNXJHUlNtK0swZ2MwSzlvdU9VNDRwVjRhalpSSGowcy9CWlRxCjhBZkhBb0dCQUtWeWpVV05wSHBZNzFFNlJxUjlsRE5sY2RjaE8zdjYwdnBUL1FjVkJyZUdqWmFBeWkremNvMlIKZlRwaUlPT0hhVUxCVVBqVmYxNTllMjRINi9PSkNMeGQrM0hzbE1lZDcvMndNUlZEWjBaV0EzbWR6SnRSMG56Zwo4ZTAweW41QTdTNm12NFJldVhvM1E1Tm1ESkxLZGk3eXNCNXVWMWpvSE9PZmRVQ3dSbDVkCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMyRENDQWNDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFkTVJzd0dRWURWUVFERXhKbE1tVXQKYzJWeWRtVnlMV05sY25RdFkyRXdIaGNOTVRrd05ERTBNRFl4TlRReVdoY05Namt3TkRFeE1EWXhOVFF5V2pBZApNUnN3R1FZRFZRUURFeEpsTW1VdGMyVnlkbVZ5TFdObGNuUXRZMkV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBCkE0SUJEd0F3Z2dFS0FvSUJBUUMrS0hhN0xIV1IrbWkwWGsyUjEzcnRyTmxTNVBHSlYxV2psMXcyWTRraEZYakcKNGRXNCtKcndwRGZjb09DY0VlOG5rcTRWbDRSZTZZT1luUyszV2lWWVlDaXJNejQ0bGUrQU9EY3c5bDZkYTNINwpEczRzSllPSklZaWRxQldtY0FxZy9tKzZBaHBsdlRiZEdxcjZuMEQ4SVhacFhJUGNpMGpSTDlqaE96ZEpqNnFlClV5Y1hCQUVkK1ZpRGpmU3drMSt0cWxUY3RaTWZxbTJwcmllUVNXSjl2R21SZXlNUFNpMVdPZ3dCbDJFVzRhN0UKcEdHM2liUCtWeERaNmlYR0g4Y2dwWDVSRlB3VC9yeUJ4WkllSmtTbFZmUVpjeWV6cXJNYkRsNGJDWTkvMzIzSgpLODFjUDM2L1BYOHg4OVk3VFhmQUtWRHZicVk5b0VlbktBT2R5d2QxQWdNQkFBR2pJekFoTUE0R0ExVWREd0VCCi93UUVBd0lDcERBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCZUZmcGkKYkQ3Mi96Nyt5a0w5SHJoOWtWL1pralM2WThkUVdnOTFQNzlJOVUzdXI2Vk9iaHJZY3VTdVZNdkFnZCtPeEEveApYTnpHYitpN2pzYzdzMXM0bXdpUnZjY0pBSnFKQmxXTWM0R1pLRVBxRW9XbUxlVXlBaEZ1WGZaVk5Yb3Y0VEJyCmdneEc0Zjcwb2VqcVh1VGNQUEdaREh1blhUQzhNMEhuaTZEY2huZ1ZVOHh4Q1cydWVYRC9paGNxSXBmcHNxa0oKL01EdnVJUjRWakZ2QVpveU1NcXhpQkYzMXlwQk5TU2RnMXRGQ05sa3hBNkZhaVM2VHhtckV5bUxFVmJ0MGxlUwo5ZzdENFdwcFo0RWRvbmtEd0lrSWpFd1BWMVFRVnhrbEZCTzFqbjMwVVBTcEpwR0RYRkNZQmo4bkZGYjV4aUtKCkNhcDRBak5xU3ZWMWZKSmsKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
---
apiVersion: v1
kind: Service
metadata:
  name: webhook-service
  namespace: tidb-operator-stability
  labels:
    app: webhook-service
spec:
  ports:
  - port: 443
    targetPort: 443
  selector:
    app: webhook
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: tidb-operator-stability
subjects:
- kind: ServiceAccount
  namespace: tidb-operator-stability
  name: tidb-operator-stability
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
---
kind: ServiceAccount
apiVersion: v1
metadata:
  namespace: tidb-operator-stability
  name: tidb-operator-stability
---
apiVersion: v1
kind: Pod
metadata:
  namespace: tidb-operator-stability
  name: tidb-operator-stability
  labels:
    app: webhook
spec:
  serviceAccount: tidb-operator-stability
  containers:
  - name: tidb-operator-stability
    image: ""
    imagePullPolicy: Always
    command:
    - /usr/local/bin/stability-test
    - --config=/etc/tidb-operator-stability/config.yaml
    - --tls-cert-file=/webhook.local.config/certificates/tls.crt
    - --tls-private-key-file=/webhook.local.config/certificates/tls.key
    volumeMounts:
    - mountPath: /logDir
      name: logdir
    - name: config
      readOnly: true
      mountPath: /etc/tidb-operator-stability
    - name: webhook-certs
      readOnly: true
      mountPath: /webhook.local.config/certificates
    env:
    - name: MY_NODE_NAME
      valueFrom:
        fieldRef:
          fieldPath: spec.nodeName
    - name: NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
  volumes:
  - name: logdir
    hostPath:
      path: /var/log
      type: Directory
  - name: config
    configMap:
      name: tidb-operator-stability-config
      items:
      - key: config
        path: config.yaml
  - name: webhook-certs
    secret:
        secretName: webhook-secret
  restartPolicy: Never
