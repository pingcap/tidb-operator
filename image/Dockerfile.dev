# Development Dockerfile for faster builds
# This Dockerfile expects pre-compiled binaries from local build
FROM --platform=$TARGETPLATFORM ghcr.io/pingcap-qe/bases/pingcap-base:v1.9.2 AS tidb-operator

ARG TARGETPLATFORM

WORKDIR /

# Copy pre-compiled binary from local build (relative to build context root)
COPY _output/bin/tidb-operator tidb-operator

USER 65532:65532

ENTRYPOINT ["/tidb-operator"]

FROM --platform=$TARGETPLATFORM ghcr.io/pingcap-qe/bases/pingcap-base:v1.9.2 AS prestop-checker

ARG TARGETPLATFORM

WORKDIR /

# Copy pre-compiled binary from local build
COPY _output/bin/prestop-checker prestop-checker

USER 65532:65532

ENTRYPOINT ["/prestop-checker"]

FROM --platform=$TARGETPLATFORM ghcr.io/pingcap-qe/bases/pingcap-base:v1.9.2 AS testing-workload

ARG TARGETPLATFORM

WORKDIR /

# Copy pre-compiled binary from local build
COPY _output/bin/testing-workload testing-workload

USER 65532:65532

ENTRYPOINT ["/testing-workload"]

FROM --platform=$TARGETPLATFORM ghcr.io/pingcap-qe/bases/pingcap-base:v1.9.2 AS tidb-backup-manager

ARG TARGETPLATFORM

WORKDIR /

# Copy pre-compiled binary from local build
COPY _output/bin/tidb-backup-manager tidb-backup-manager

USER 65532:65532

ENTRYPOINT ["/tidb-backup-manager"]