# TiCI example

This example deploys a TiDB cluster with TiCI + TiFlash + TiCDC using a local MinIO.

## Prereqs
- A StorageClass named `standard` (or edit the YAML to your StorageClass).
- MinIO deployed in the same namespace (see below).
- The TiCI binary is located at `/tici-server` inside the TiCI image.
  If you are using a stock operator that runs `tici-server` from PATH, add
  `TICI_BIN=/tici-server` or extend `PATH` in `spec.tici.meta/worker.env`.

## Deploy MinIO (test-only)
Use the e2e MinIO manifest and create the bucket once:

```
kubectl -n <ns> apply -f ../../tests/images/e2e/minio/minio.yaml
```

Create bucket `ticidefaultbucket` (example with mc):

```
# assuming you have mc locally
mc alias set localminio http://minio-service.<ns>.svc:9000 12345678 12345678
mc mb --ignore-existing localminio/ticidefaultbucket
```

## Deploy the cluster

```
kubectl -n <ns> apply -f tidb-cluster.yaml
```

## Notes
- TiFlash config is generated by the operator; this example sets
  `tici.logger.filename = /dev/stdout` so TiCI searchlib logs go to stdout.
- If you are running on kind/podman, ensure pod PID limits are removed
  (TasksMax/infinity) to avoid `newosproc` failures.
