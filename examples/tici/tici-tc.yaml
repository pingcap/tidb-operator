apiVersion: pingcap.com/v1alpha1
kind: TidbCluster
metadata:
  name: tici-demo
spec:
  version: v8.5.5
  imagePullPolicy: IfNotPresent
  timezone: UTC
  pvReclaimPolicy: Retain
  enableDynamicConfiguration: true
  discovery: {}
  helper:
    image: alpine:3.16.0

  pd:
    replicas: 1
    baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/tikv/pd/image
    version: master
    requests:
      storage: 1Gi
    storageClassName: standard
    config: |
      [replication]
        enable-placement-rules = true

  tikv:
    replicas: 1
    baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/tikv/tikv/image
    version: master
    requests:
      storage: 1Gi
    storageClassName: standard
    evictLeaderTimeout: 1m
    config:
      storage:
        reserve-space: "0MB"
      rocksdb:
        max-open-files: 256
      raftdb:
        max-open-files: 256

  tidb:
    replicas: 1
    config: ""
    baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tidb/images/tidb-server
    version: feature-fts
    service:
      type: ClusterIP

  tiflash:
    replicas: 1
    baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tiflash/image
    version: feature-fts
    config:
      config: |
        [tici.logger]
          filename = "/dev/stdout"
          level = "info"
    storageClaims:
    - resources:
        requests:
          storage: 1Gi
      storageClassName: standard

  ticdc:
    replicas: 1
    baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/ticdc/image
    version: master

  tici:
    meta:
      replicas: 1
      baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tici/image
      version: master
    worker:
      replicas: 1
      baseImage: us-docker.pkg.dev/pingcap-testing-account/hub/pingcap/tici/image
      version: master
    s3:
      endpoint: http://minio-service:9000
      region: us-east-1
      accessKey: "12345678"
      secretKey: "12345678"
      bucket: ticidefaultbucket
      prefix: tici_default_prefix
      usePathStyle: true
    changefeed:
      enable: true
      changefeedID: tici-replication-task
